{"version":3,"file":"bundle.umd.js","sources":["../../../../eagle-sdk/xhrHook.js","../../../../eagle-sdk/index.js"],"sourcesContent":["export default {\r\n  init: (cb) => {\r\n    let xhr = window.XMLHttpRequest;\r\n    if (xhr._eagle_monitor_flag === true) {\r\n      return void 0;\r\n    }\r\n    xhr._eagle_monitor_flag === true;\r\n    let _originOpen = xhr.prototype.open;\r\n    xhr.prototype.open = function (method, url, async, user, password) {\r\n      this._eagle_xhr_info = {\r\n        url,method,status: null\r\n      }\r\n      return _originOpen.apply(this, arguments);\r\n    }\r\n\r\n    let _originSend = xhr.prototype.send;\r\n\r\n    xhr.prototype.send = function (value) {\r\n      let _self= this;\r\n      this._eagle_start_time = Date.now();\r\n      let ajaxEnd = (eventType)=> ()=>{\r\n        if(_self.response){\r\n          let responseSize = null;\r\n          switch (_self.responseType) {\r\n            case 'json':\r\n              // JSON兼容性问题\r\n              responseSize = JSON.stringify(_self.response).length;\r\n              break;\r\n            case 'arraybuffer':\r\n              responseSize = _self.response.byteLength;\r\n            default:\r\n              responseSize = _self.responseText.length;\r\n          }\r\n          _self._eagle_xhr_info.event = eventType;\r\n          _self._eagle_xhr_info.status = _self.status;\r\n          _self._eagle_xhr_info.success = _self.status === 200;\r\n          _self._eagle_xhr_info.duration = Date.now() - _self._eagle_start_time;\r\n          _self._eagle_xhr_info.responseSize\r\n           = responseSize;\r\n           _self._eagle_xhr_info.requestSize = value? value.length : 0; // value 一定有 length\r\n          _self._eagle_xhr_info.type = 'xhr';\r\n          cb(_self._eagle_xhr_info)\r\n        }\r\n      };\r\n\r\n      // 这三种状态都代表这请求已经结束了 需要统计一些信息 并报上去\r\n      this.addEventListener('load', ajaxEnd('load'), false);\r\n      this.addEventListener('error', ajaxEnd('error'), false);\r\n      this.addEventListener('abort', ajaxEnd('abort'), false);\r\n\r\n      return _originSend.apply(this, arguments);\r\n    }\r\n  }\r\n}","// import perf from './perf.js'\r\n// import resource from './resource.js'\r\nimport xhrHook from './xhrHook.js'\r\n\r\n\r\n// perf.init((perform)=>{\r\n//     console.log('perf init', perform);\r\n// })\r\n\r\n// resource.init((resourceData) => {\r\n//     console.log('resource init', resourceData);\r\n// })\r\n\r\nxhrHook.init((xhrInfo) => {\r\n    console.log('xhrInfo init', xhrInfo);\r\n})"],"names":[],"mappings":"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"}